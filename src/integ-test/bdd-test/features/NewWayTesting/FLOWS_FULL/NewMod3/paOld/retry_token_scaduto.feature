Feature: NM3 flows PA Old con retry a token scaduto

    Background:
        Given systems up


    # spo arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_1 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spo+ con resp PPT_TOKEN_SCADUTO nodoInviaRPT -> paaInviaRT+ BIZ+ (NM3-17)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | OK                                          |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | sendPaymentOutcome                          |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                        |
            | ID                    | NotNone                                                                                      |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                                                            |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                                                          |
            | STATUS                | PAYING,CANCELLED_NORPT,PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED                        |
            | INSERTED_TIMESTAMP    | NotNone                                                                                      |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                                                       |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken                                                  |
            | INSERTED_BY           | activatePaymentNotice,mod3CancelV1,sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC           |
        And verify 6 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | NOTICE_STORED                               |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | nodoInviaRPT                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC           |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                   |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 0                                           |
            | ESITO               | ESEGUITO                                    |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 10                                          |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value $rptAttachment in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0


    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in OK
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_2 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ- spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp OK nodoInviaRPT con ccp-v2 -> paaInviaRT+ BIZ+ token-v2 (NM3-19)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                   |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # spo- arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_3 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ- spo- con resp PPT_TOKEN_SCADUTO_KO (NM3-20)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | KO      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO_KO of sendPaymentOutcome response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | KO                                          |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | sendPaymentOutcome                          |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value KO in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in KO
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_4 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ- spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp KO BIZ attivazione fallita (NM3-23)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        And from body with datatable horizontal paaAttivaRPT_KO initial XML paaAttivaRPT
            | faultCode              | faultString         | id                          | description                            | esito |
            | PAA_SEMANTICA_EXTRAXSD | errore semantico PA | #creditor_institution_code# | Errore semantico emesso dalla PA esito | KO    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PAAATTIVARPTRESP      | Y                                              |
            | NODOINVIARPTREQ       | N                                              |
            | PAAATTIVARPTERROR     | N                                              |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | sendPaymentOutcome                             |
            | RETRY_PENDING         | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in OK
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_5 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activateV2 -> paaAttivaRPT nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ- spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp OK nodoInviaRPT con ccp-v2 -> paaInviaRT+ BIZ+ token-v2 (NM3-45)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #intermediarioPSP2#                              |
            | CHANNEL_ID                 | #canale32#                                       |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                       |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                     |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2          |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | nodoInviaRPT                                     |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # spo arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_6 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spoV2+ con resp PPT_TOKEN_SCADUTO nodoInviaRPT -> paaInviaRT+ BIZ+ (NM3-43)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | OK                                            |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | sendPaymentOutcomeV2                          |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                            |
            | ID                    | NotNone                                                                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                                                              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                                                            |
            | STATUS                | PAYING,CANCELLED_NORPT,PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED                            |
            | INSERTED_TIMESTAMP    | NotNone                                                                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken                                                    |
            | INSERTED_BY           | activatePaymentNoticeV2,mod3CancelV1,sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC             |
        And verify 6 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | NOTICE_STORED                                 |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | nodoInviaRPT                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC             |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 0                                             |
            | ESITO               | ESEGUITO                                      |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 10                                            |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value $rptAttachment in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0


    # spo arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_7 @after
    Scenario: NM3 flow OK, FLOW con PA Old, PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spoV2+ con resp PPT_TOKEN_SCADUTO nodoInviaRPT -> paaInviaRT+ BIZ+ (NM3-62)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | OK                                          |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | sendPaymentOutcomeV2                        |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                          |
            | ID                    | NotNone                                                                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                                                              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                                                            |
            | STATUS                | PAYING,CANCELLED_NORPT,PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED                          |
            | INSERTED_TIMESTAMP    | NotNone                                                                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken                                                    |
            | INSERTED_BY           | activatePaymentNotice,mod3CancelV1,sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC           |
        And verify 6 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | NOTICE_STORED                               |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | nodoInviaRPT                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                        |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC           |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                   |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 0                                           |
            | ESITO               | ESEGUITO                                    |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 10                                          |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value $rptAttachment in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # spo arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_8 @after
    Scenario: NM3 flow OK, FLOW con PA Old, PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spoV2+ con resp PPT_TOKEN_SCADUTO nodoInviaRPT -> paaInviaRT+ BIZ+ (NM3-79)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | OK                                            |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | sendPaymentOutcomeV2                          |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                            |
            | ID                    | NotNone                                                                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                                                              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                                                            |
            | STATUS                | PAYING,CANCELLED_NORPT,PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED                            |
            | INSERTED_TIMESTAMP    | NotNone                                                                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken                                                    |
            | INSERTED_BY           | activatePaymentNoticeV2,mod3CancelV1,sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC             |
        And verify 6 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | NOTICE_STORED                                 |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | nodoInviaRPT                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                          |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode   |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC             |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values              |
            | IUV        | 12$iuv                    |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values |
            | IUV        | 12$iuv       |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 0                                             |
            | ESITO               | ESEGUITO                                      |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 10                                            |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value $rptAttachment in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # spo- arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_9 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spo- con resp PPT_TOKEN_SCADUTO_KO nodoInviaRPT -> paaInviaRT- (NM3-18)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | KO      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO_KO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | KO                                          |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | sendPaymentOutcome                          |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                              |
            | ID                    | NotNone                                                            |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                                  |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                                |
            | STATUS                | PAYING,CANCELLED_NORPT,FAILED_NORPT,FAILED                         |
            | INSERTED_TIMESTAMP    | NotNone                                                            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                             |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken                        |
            | INSERTED_BY           | activatePaymentNotice,mod3CancelV1,sendPaymentOutcome,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | FAILED                                      |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | nodoInviaRPT                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                   |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_KO,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value KO in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0



    # spo- arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_10 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT (scadenza sessione)  mod3cancelV1  BIZ- spoV2- con resp PPT_TOKEN_SCADUTO_KO nodoInviaRPT -> paaInviaRT- (NM3-44)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | KO      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO_KO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | KO                                            |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | sendPaymentOutcomeV2                          |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                  |
            | ID                    | NotNone                                                                |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                                    |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                                  |
            | STATUS                | PAYING,CANCELLED_NORPT,FAILED_NORPT,FAILED                             |
            | INSERTED_TIMESTAMP    | NotNone                                                                |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                                 |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken                          |
            | INSERTED_BY           | activatePaymentNoticeV2,mod3CancelV1,sendPaymentOutcomeV2,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | FAILED                                        |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | nodoInviaRPT                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_KO,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value KO in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0






    # sessione scade dopo RPT ma prima di SPO, la SPO arriva quando al RPT è in stato RT_RIFIUTATA_PA
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_11 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- resp KO BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> Nodo crea payment-v2 in stato PAID (NM3-21)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RPT
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.fault.faultCode xml check value PAA_SINTASSI_XSD in position 0
        And from $paaInviaRTResp.fault.faultString xml check value RT non valida rispetto XSD in position 0
        And from $paaInviaRTResp.fault.id xml check value mockPa in position 0
        And from $paaInviaRTResp.fault.description xml check value test in position 0
        And from $paaInviaRTResp.esito xml check value KO in position 0





    # sessione scade dopo RPT ma prima di SPO, la SPO arriva quando al RPT è in stato RT_RIFIUTATA_PA
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_12 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- resp KO BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> Nodo crea payment-v2 in stato PAID (NM3-47)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | sendPaymentOutcomeV2                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RPT
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.fault.faultCode xml check value PAA_SINTASSI_XSD in position 0
        And from $paaInviaRTResp.fault.faultString xml check value RT non valida rispetto XSD in position 0
        And from $paaInviaRTResp.fault.id xml check value mockPa in position 0
        And from $paaInviaRTResp.fault.description xml check value test in position 0
        And from $paaInviaRTResp.esito xml check value KO in position 0







    # sessione scade dopo RPT ma prima di SPO, la SPO arriva quando al RPT è in stato RT_RIFIUTATA_PA
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_13 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- resp KO BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> Nodo crea payment-v2 in stato PAID (NM3-64)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RPT
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.fault.faultCode xml check value PAA_SINTASSI_XSD in position 0
        And from $paaInviaRTResp.fault.faultString xml check value RT non valida rispetto XSD in position 0
        And from $paaInviaRTResp.fault.id xml check value mockPa in position 0
        And from $paaInviaRTResp.fault.description xml check value test in position 0
        And from $paaInviaRTResp.esito xml check value KO in position 0








    # sessione scade dopo RPT ma prima di SPO, la SPO arriva quando al RPT è in stato RT_RIFIUTATA_PA
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_14 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- resp KO BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> Nodo crea payment-v2 in stato PAID (NM3-81)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | sendPaymentOutcome                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RPT
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT WITH NORMAL TOKEN
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.fault.faultCode xml check value PAA_SINTASSI_XSD in position 0
        And from $paaInviaRTResp.fault.faultString xml check value RT non valida rispetto XSD in position 0
        And from $paaInviaRTResp.fault.id xml check value mockPa in position 0
        And from $paaInviaRTResp.fault.description xml check value test in position 0
        And from $paaInviaRTResp.esito xml check value KO in position 0




    # spo- arriva dopo la scadenza della sessione ma prima della RPT
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_15 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ- spoV2- con resp PPT_TOKEN_SCADUTO_KO (NM3-46)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | KO      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO_KO of sendPaymentOutcomeV2 response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | KO                                            |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | sendPaymentOutcomeV2                          |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value KO in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in KO
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_16 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp KO BIZ attivazione fallita (NM3-49)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        And from body with datatable horizontal paaAttivaRPT_KO initial XML paaAttivaRPT
            | faultCode              | faultString         | id                          | description                            | esito |
            | PAA_SEMANTICA_EXTRAXSD | errore semantico PA | #creditor_institution_code# | Errore semantico emesso dalla PA esito | KO    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PAAATTIVARPTRESP      | Y                                                |
            | NODOINVIARPTREQ       | N                                                |
            | PAAATTIVARPTERROR     | N                                                |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | sendPaymentOutcomeV2                             |
            | RETRY_PENDING         | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | sendPaymentOutcomeV2                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value KO in position 0
        And from $paaAttivaRPTResp.fault.faultCode xml check value PAA_SEMANTICA_EXTRAXSD in position 0
        And from $paaAttivaRPTResp.fault.faultString xml check value errore semantico PA in position 0
        And from $paaAttivaRPTResp.fault.id xml check value 66666666666 in position 0
        And from $paaAttivaRPTResp.fault.description xml check value Errore semantico emesso dalla PA esito in position 0




    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in OK
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_17 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp OK nodoInviaRPT con ccp-v2 -> paaInviaRT+ BIZ+ token-v2 (NM3-63)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #intermediarioPSP2#                            |
            | CHANNEL_ID                 | #canale32#                                     |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #intermediarioPSP2#                         |
            | CHANNEL_ID                 | #canale32#                                  |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                         |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2              |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | nodoInviaRPT                                   |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0






    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in KO
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_18 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp KO BIZ attivazione fallita (NM3-66)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        And from body with datatable horizontal paaAttivaRPT_KO initial XML paaAttivaRPT
            | faultCode              | faultString         | id                          | description                            | esito |
            | PAA_SEMANTICA_EXTRAXSD | errore semantico PA | #creditor_institution_code# | Errore semantico emesso dalla PA esito | KO    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PAAATTIVARPTRESP      | Y                                              |
            | NODOINVIARPTREQ       | N                                              |
            | PAAATTIVARPTERROR     | N                                              |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | sendPaymentOutcomeV2                           |
            | RETRY_PENDING         | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value KO in position 0
        And from $paaAttivaRPTResp.fault.faultCode xml check value PAA_SEMANTICA_EXTRAXSD in position 0
        And from $paaAttivaRPTResp.fault.faultString xml check value errore semantico PA in position 0
        And from $paaAttivaRPTResp.fault.id xml check value 66666666666 in position 0
        And from $paaAttivaRPTResp.fault.description xml check value Errore semantico emesso dalla PA esito in position 0





    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in OK
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_19 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp OK nodoInviaRPT con ccp-v2 -> paaInviaRT+ BIZ+ token-v2 (NM3-80)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #intermediarioPSP2#                              |
            | CHANNEL_ID                 | #canale32#                                       |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                       |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                     |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2          |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | nodoInviaRPT                                     |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in KO
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_20 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 e resp KO BIZ attivazione fallita (NM3-83)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        And from body with datatable horizontal paaAttivaRPT_KO initial XML paaAttivaRPT
            | faultCode              | faultString         | id                          | description                            | esito |
            | PAA_SEMANTICA_EXTRAXSD | errore semantico PA | #creditor_institution_code# | Errore semantico emesso dalla PA esito | KO    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PAAATTIVARPTRESP      | Y                                                |
            | NODOINVIARPTREQ       | N                                                |
            | PAAATTIVARPTERROR     | N                                                |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | sendPaymentOutcome                               |
            | RETRY_PENDING         | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | sendPaymentOutcome                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value KO in position 0
        And from $paaAttivaRPTResp.fault.faultCode xml check value PAA_SEMANTICA_EXTRAXSD in position 0
        And from $paaAttivaRPTResp.fault.faultString xml check value errore semantico PA in position 0
        And from $paaAttivaRPTResp.fault.id xml check value 66666666666 in position 0
        And from $paaAttivaRPTResp.fault.description xml check value Errore semantico emesso dalla PA esito in position 0




    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_21 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-25)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | paRetryAttivaRpt                               |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_22 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-51)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | paRetryAttivaRpt                                 |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | nodoInviaRPT                                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0








    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_23 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-68)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | paRetryAttivaRpt                               |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                         |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2              |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | nodoInviaRPT                                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_24 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-85)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | paRetryAttivaRpt                                 |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                       |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                     |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2          |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | nodoInviaRPT                                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0









    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_25 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP POSTE vp1: verificaBollettino -> paaVerificaRPT, activate Poste -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ Poste con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-101)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal verificaBollettino_noOptional initial XML verificaBollettino
            | idPSP      | idBrokerPSP      | idChannel      | password   | ccPost    | noticeNumber |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #ccPoste# | 312#iuv#     |
        And from body with datatable vertical paaVerificaRPT_noOptional initial XML paaVerificaRPT
            | esito                    | OK                              |
            | importoSingoloVersamento | 10.00                           |
            | ibanAccredito            | IT45R0760103200#ccPoste#        |
            | causaleVersamento        | prova/RFDB/019551233153100/TXT/ |
        And EC replies to nodo-dei-pagamenti with the paaVerificaRPT
        When psp sends SOAP verificaBollettino to nodo-dei-pagamenti
        Then check outcome is OK of verificaBollettino response
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP      | idBrokerPSP      | idChannel      | password   | fiscalCode                  | noticeNumber | amount |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #creditor_institution_code# | 312$iuv      | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP      | idBrokerPSP      | idChannel      | password   | paymentToken                                | outcome |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #pspPoste#                                     |
            | BROKER_PSP_ID              | #brokerPspPoste#                               |
            | CHANNEL_ID                 | #channelPoste#                                 |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | paRetryAttivaRpt                               |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #pspPoste#                                  |
            | BROKER_PSP_ID              | #brokerPspPoste#                            |
            | CHANNEL_ID                 | #channelPoste#                              |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #pspPoste# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #channelPoste# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #pspPoste# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #channelPoste# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0




    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_26 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP POSTE vp2: verificaBollettino -> paaVerificaRPT, activateV2 Poste -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ Poste con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-102)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal verificaBollettino_noOptional initial XML verificaBollettino
            | idPSP      | idBrokerPSP      | idChannel      | password   | ccPost    | noticeNumber |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #ccPoste# | 312#iuv#     |
        And from body with datatable vertical paaVerificaRPT_noOptional initial XML paaVerificaRPT
            | esito                    | OK                              |
            | importoSingoloVersamento | 10.00                           |
            | ibanAccredito            | IT45R0760103200#ccPoste#        |
            | causaleVersamento        | prova/RFDB/019551233153100/TXT/ |
        And EC replies to nodo-dei-pagamenti with the paaVerificaRPT
        When psp sends SOAP verificaBollettino to nodo-dei-pagamenti
        Then check outcome is OK of verificaBollettino response
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP      | idBrokerPSP      | idChannel      | password   | fiscalCode                  | noticeNumber | amount |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #creditor_institution_code# | 312$iuv      | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP      | idBrokerPSP      | idChannel      | password   | paymentToken                                  | outcome |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #pspPoste#                                       |
            | BROKER_PSP_ID              | #brokerPspPoste#                                 |
            | CHANNEL_ID                 | #channelPoste#                                   |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | paRetryAttivaRpt                                 |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #pspPoste#                                    |
            | BROKER_PSP_ID              | #brokerPspPoste#                              |
            | CHANNEL_ID                 | #channelPoste#                                |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | nodoInviaRPT                                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #pspPoste# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #channelPoste# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #pspPoste# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #channelPoste# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0






    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_27 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP POSTE vp2 activate e PSP POSTE vp1 spo: verificaBollettino -> paaVerificaRPT, activateV2 Poste -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ Poste con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-103)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal verificaBollettino_noOptional initial XML verificaBollettino
            | idPSP      | idBrokerPSP      | idChannel      | password   | ccPost    | noticeNumber |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #ccPoste# | 312#iuv#     |
        And from body with datatable vertical paaVerificaRPT_noOptional initial XML paaVerificaRPT
            | esito                    | OK                              |
            | importoSingoloVersamento | 10.00                           |
            | ibanAccredito            | IT45R0760103200#ccPoste#        |
            | causaleVersamento        | prova/RFDB/019551233153100/TXT/ |
        And EC replies to nodo-dei-pagamenti with the paaVerificaRPT
        When psp sends SOAP verificaBollettino to nodo-dei-pagamenti
        Then check outcome is OK of verificaBollettino response
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP      | idBrokerPSP      | idChannel      | password   | fiscalCode                  | noticeNumber | amount |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #creditor_institution_code# | 312$iuv      | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP      | idBrokerPSP      | idChannel      | password   | paymentToken                                  | outcome |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #pspPoste#                                       |
            | BROKER_PSP_ID              | #brokerPspPoste#                                 |
            | CHANNEL_ID                 | #channelPoste#                                   |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | paRetryAttivaRpt                                 |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #pspPoste#                                    |
            | BROKER_PSP_ID              | #brokerPspPoste#                              |
            | CHANNEL_ID                 | #channelPoste#                                |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                       |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                     |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2          |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | nodoInviaRPT                                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #pspPoste# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #channelPoste# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #pspPoste# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #channelPoste# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene accettata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_28 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP POSTE vp1 activate e PSP POSTE vp2 spo: verificaBollettino -> paaVerificaRPT, activate Poste -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ Poste con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA accetta RT job retryAttiva, Nodo fa la paaAttivaRPT con token-v2, nodoInviaRPT con ccp-v2 -> paaInviaRT+ con ccp-v2 BIZ+ (NM3-104)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal verificaBollettino_noOptional initial XML verificaBollettino
            | idPSP      | idBrokerPSP      | idChannel      | password   | ccPost    | noticeNumber |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #ccPoste# | 312#iuv#     |
        And from body with datatable vertical paaVerificaRPT_noOptional initial XML paaVerificaRPT
            | esito                    | OK                              |
            | importoSingoloVersamento | 10.00                           |
            | ibanAccredito            | IT45R0760103200#ccPoste#        |
            | causaleVersamento        | prova/RFDB/019551233153100/TXT/ |
        And EC replies to nodo-dei-pagamenti with the paaVerificaRPT
        When psp sends SOAP verificaBollettino to nodo-dei-pagamenti
        Then check outcome is OK of verificaBollettino response
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP      | idBrokerPSP      | idChannel      | password   | fiscalCode                  | noticeNumber | amount |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | #creditor_institution_code# | 312$iuv      | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP      | idBrokerPSP      | idChannel      | password   | paymentToken                                | outcome |
            | #pspPoste# | #brokerPspPoste# | #channelPoste# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT initial XML paaInviaRT
            | esito |
            | OK    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 5 seconds for expiration
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #pspPoste#                                     |
            | BROKER_PSP_ID              | #brokerPspPoste#                               |
            | CHANNEL_ID                 | #channelPoste#                                 |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | paRetryAttivaRpt                               |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #pspPoste#                                  |
            | BROKER_PSP_ID              | #brokerPspPoste#                            |
            | CHANNEL_ID                 | #channelPoste#                              |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                         |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2              |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | nodoInviaRPT                                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #pspPoste# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #channelPoste# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #pspPoste# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #brokerPspPoste# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #channelPoste# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0





    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene rifiutata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_29 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA rifiuta RT job retryAttiva, Nodo crea payment-v2 in stato PAID_NORPT,PAID (NM3-26)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT,PAID                                |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome,paRetryAttivaRpt            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | paRetryAttivaRpt                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RPT -v2
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT -v2
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0




    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene rifiutata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_30 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA rifiuta RT job retryAttiva, Nodo crea payment-v2 in stato PAID_NORPT (NM3-52)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | sendPaymentOutcomeV2                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT,PAID                                  |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2,paRetryAttivaRpt            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | paRetryAttivaRpt                                 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RPT -v2
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT -v2
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0






    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene rifiutata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_31 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA rifiuta RT job retryAttiva, Nodo crea payment-v2 in stato PAID_NORPT,PAID (NM3-69)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT,PAID                                |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2,paRetryAttivaRpt          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID                                           |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | paRetryAttivaRpt                               |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                                                    |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                                                          |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT con -v2
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paRetryPaInviaRtNegative                    |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RPT -v2
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        # RT -v2
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA_KO                                  |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0







    # sessione scade dopo RPT ma prima di SPO (stato RPT diverso da RT_ACCETTATA_PA e da RT_RIFIUTATA_PA), poi la RT viene rifiutata e si fa retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_32 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> RT non ancora accettata/rifiutata dalla PA BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> inserimento in coda RETRY_PA_ATTIVA_RPT, PA rifiuta RT job retryAttiva, Nodo crea payment-v2 in stato PAID_NORPT (NM3-86)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to false
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        Given from body with datatable horizontal paaInviaRT_Timeout_KO initial XML paaInviaRT
            | esito | delay |
            | OK    | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given from body with datatable horizontal paaInviaRT_KO initial XML paaInviaRT
            | faultCode        | faultString                | id     | description | esito |
            | PAA_SINTASSI_XSD | RT non valida rispetto XSD | mockPa | test        | KO    |
        And EC replies to nodo-dei-pagamenti with the paaInviaRT
        And nodo-dei-pagamenti has config parameter scheduler.jobName_paRetryPaInviaRtNegative.enabled set to true
        And waiting after triggered refresh job ALL
        When job paRetryPaInviaRtNegative triggered after 5 seconds
        Then verify the HTTP status code of paRetryPaInviaRtNegative response is 200
        And wait 5 seconds for expiration
        When job paRetryAttivaRpt triggered after 5 seconds
        Then verify the HTTP status code of paRetryAttivaRpt response is 200
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT,PAID                                  |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome,paRetryAttivaRpt              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        # POSITION_PAYMENT_STATUS_SNAPSHOT con -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID                                             |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | paRetryAttivaRpt                                 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                                                |
            | ID                    | NotNone                                                                                                                                              |
            | ID_SESSIONE           | NotNone                                                                                                                                              |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                                              |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                                                  |
            | IUV                   | 12$iuv                                                                                                                                               |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                                                        |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ESITO_SCONOSCIUTO_PA,RT_INVIATA_PA,RT_RIFIUTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT,paRetryPaInviaRtNegative,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 8 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT con -v2
        And verify 0 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_RIFIUTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paRetryPaInviaRtNegative                      |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RPT -v2
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        # RT -v2
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA_KO                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0






    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), RPT2 arriva prima di OK a retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_33 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2  REQ, nodoInviaRPT con ccp-v2 -> aspetta lock, paaAttivaRPT con token-v2 RESP OK, nodoInviaRPT con ccp-v2 viene processata e genera paaInviaRT+ BIZ+ (NM3-22)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_delay_noOptional initial XML paaAttivaRPT
            | delay | esito | importoSingoloVersamento |
            | 2550  | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #intermediarioPSP2#                            |
            | CHANNEL_ID                 | #canale32#                                     |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #intermediarioPSP2#                         |
            | CHANNEL_ID                 | #canale32#                                  |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                   |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0






    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), RPT2 arriva prima di OK a retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_34 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2  REQ, nodoInviaRPT con ccp-v2 -> aspetta lock, paaAttivaRPT con token-v2 RESP OK, nodoInviaRPT con ccp-v2 viene processata e genera paaInviaRT+ BIZ+ (NM3-48)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_delay_noOptional initial XML paaAttivaRPT
            | delay | esito | importoSingoloVersamento |
            | 2550  | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #intermediarioPSP2#                              |
            | CHANNEL_ID                 | #canale32#                                       |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | sendPaymentOutcomeV2                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                         |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                       |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2            |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | nodoInviaRPT                                     |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0






    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), RPT2 arriva prima di OK a retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_35 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2  REQ, nodoInviaRPT con ccp-v2 -> aspetta lock, paaAttivaRPT con token-v2 RESP OK, nodoInviaRPT con ccp-v2 viene processata e genera paaInviaRT+ BIZ+ (NM3-65)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_delay_noOptional initial XML paaAttivaRPT
            | delay | esito | importoSingoloVersamento |
            | 2550  | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #intermediarioPSP2#                            |
            | CHANNEL_ID                 | #canale32#                                     |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | $activatePaymentNotice.amount                  |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | NotNone                                        |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #intermediarioPSP2#                         |
            | CHANNEL_ID                 | #canale32#                                  |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                       |
            | ID                    | NotNone                                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode                           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber                         |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED              |
            | INSERTED_TIMESTAMP    | NotNone                                                     |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2              |
            | INSERTED_BY           | sendPaymentOutcomeV2,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                  |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | nodoInviaRPT                                   |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                                             |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2                                                                                |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                          |
            | ID_SESSIONE        | NotNone                                        |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode              |
            | IUV                | 12$iuv                                         |
            | CCP                | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                |
            | INSERTED_BY        | nodoInviaRPT                                   |
            | UPDATED_BY         | paaInviaRT                                     |
            | INSERTED_TIMESTAMP | NotNone                                        |
            | UPDATED_TIMESTAMP  | NotNone                                        |
            | PUSH               | None                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                          |
            | ID_SESSIONE                 | NotNone                                        |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode              |
            | IUV                         | 12$iuv                                         |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                        |
            | DATA_MSG_RICH               | NotNone                                        |
            | FLAG_CANC                   | N                                              |
            | IBAN_ADDEBITO               | NotNone                                        |
            | ID_MSG_RICH                 | NotNone                                        |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                               |
            | INTERMEDIARIOPA             | #id_broker_old#                                |
            | CANALE                      | #canaleFittizio#                               |
            | PSP                         | #pspFittizio#                                  |
            | INTERMEDIARIOPSP            | #brokerFittizio#                               |
            | TIPO_VERSAMENTO             | PO                                             |
            | NUM_VERSAMENTI              | 1                                              |
            | RT_SIGNATURE_CODE           | 0                                              |
            | SOMMA_VERSAMENTI            | 10                                             |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                           |
            | FK_CARRELLO                 | None                                           |
            | INSERTED_TIMESTAMP          | NotNone                                        |
            | UPDATED_TIMESTAMP           | NotNone                                        |
            | RICEVUTA_PM                 | N                                              |
            | WISP_2                      | N                                              |
            | FLAG_SECONDA                | None                                           |
            | FLAG_IO                     | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                          |
            | ID_SESSIONE         | NotNone                                        |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode              |
            | IUV                 | 12$iuv                                         |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken-v2 |
            | COD_ESITO           | 0                                              |
            | ESITO               | ESEGUITO                                       |
            | DATA_RICEVUTA       | NotNone                                        |
            | DATA_RICHIESTA      | NotNone                                        |
            | ID_RICEVUTA         | NotNone                                        |
            | ID_RICHIESTA        | NotNone                                        |
            | SOMMA_VERSAMENTI    | 10                                             |
            | INSERTED_TIMESTAMP  | NotNone                                        |
            | UPDATED_TIMESTAMP   | NotNone                                        |
            | CANALE              | #canaleFittizio#                               |
            | NOTIFICA_PROCESSATA | N                                              |
            | GENERATA_DA         | NMP                                            |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA                                        |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0








    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), RPT2 arriva prima di OK a retry attiva
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_36 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2  REQ, nodoInviaRPT con ccp-v2 -> aspetta lock, paaAttivaRPT con token-v2 RESP OK, nodoInviaRPT con ccp-v2 viene processata e genera paaInviaRT+ BIZ+ (NM3-82)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP         | idChannel  | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_delay_noOptional initial XML paaAttivaRPT
            | delay | esito | importoSingoloVersamento |
            | 2550  | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP         | idChannel  | password   | paymentToken                                  | outcome |
            | #psp# | #intermediarioPSP2# | #canale32# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #intermediarioPSP2#                              |
            | CHANNEL_ID                 | #canale32#                                       |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | $activatePaymentNoticeV2.amount                  |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | NotNone                                          |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                               |
            | UPDATED_BY                 | sendPaymentOutcome                               |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #intermediarioPSP2#                           |
            | CHANNEL_ID                 | #canale32#                                    |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                     |
            | ID                    | NotNone                                                   |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode                       |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber                     |
            | STATUS                | PAID_NORPT,PAID,NOTICE_GENERATED,NOTICE_STORED            |
            | INSERTED_TIMESTAMP    | NotNone                                                   |
            | CREDITOR_REFERENCE_ID | 12$iuv                                                    |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2          |
            | INSERTED_BY           | sendPaymentOutcome,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 4 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | NOTICE_STORED                                    |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                               |
            | UPDATED_BY            | nodoInviaRPT                                     |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                                         |
            | ID                    | NotNone                                                                                                                       |
            | ID_SESSIONE           | NotNone                                                                                                                       |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                                       |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                                           |
            | IUV                   | 12$iuv                                                                                                                        |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2                                                                              |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RPT_RISOLTA_OK,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,paaInviaRT                                      |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                                       |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 7 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                            |
            | ID_SESSIONE        | NotNone                                          |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                | 12$iuv                                           |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO              | RT_ACCETTATA_PA                                  |
            | INSERTED_BY        | nodoInviaRPT                                     |
            | UPDATED_BY         | paaInviaRT                                       |
            | INSERTED_TIMESTAMP | NotNone                                          |
            | UPDATED_TIMESTAMP  | NotNone                                          |
            | PUSH               | None                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                            |
            | ID_SESSIONE                 | NotNone                                          |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                         | 12$iuv                                           |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BIC_ADDEBITO                | NotNone                                          |
            | DATA_MSG_RICH               | NotNone                                          |
            | FLAG_CANC                   | N                                                |
            | IBAN_ADDEBITO               | NotNone                                          |
            | ID_MSG_RICH                 | NotNone                                          |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                                 |
            | INTERMEDIARIOPA             | #id_broker_old#                                  |
            | CANALE                      | #canaleFittizio#                                 |
            | PSP                         | #pspFittizio#                                    |
            | INTERMEDIARIOPSP            | #brokerFittizio#                                 |
            | TIPO_VERSAMENTO             | PO                                               |
            | NUM_VERSAMENTI              | 1                                                |
            | RT_SIGNATURE_CODE           | 0                                                |
            | SOMMA_VERSAMENTI            | 10                                               |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                             |
            | FK_CARRELLO                 | None                                             |
            | INSERTED_TIMESTAMP          | NotNone                                          |
            | UPDATED_TIMESTAMP           | NotNone                                          |
            | RICEVUTA_PM                 | N                                                |
            | WISP_2                      | N                                                |
            | FLAG_SECONDA                | None                                             |
            | FLAG_IO                     | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                            |
            | ID_SESSIONE         | NotNone                                          |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                 | 12$iuv                                           |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | COD_ESITO           | 0                                                |
            | ESITO               | ESEGUITO                                         |
            | DATA_RICEVUTA       | NotNone                                          |
            | DATA_RICHIESTA      | NotNone                                          |
            | ID_RICEVUTA         | NotNone                                          |
            | ID_RICHIESTA        | NotNone                                          |
            | SOMMA_VERSAMENTI    | 10                                               |
            | INSERTED_TIMESTAMP  | NotNone                                          |
            | UPDATED_TIMESTAMP   | NotNone                                          |
            | CANALE              | #canaleFittizio#                                 |
            | NOTIFICA_PROCESSATA | N                                                |
            | GENERATA_DA         | NMP                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale32# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #intermediarioPSP2# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale32# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                            |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value 10.00 in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value IT45R0760103200000000001016 in position 0
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA                                          |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Req
        And from $paaInviaRTV2Req.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTV2Req.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTV2Req.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTV2Req.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaInviaRTV2Req.rt xml check value NotNone in position 0
        # paaInviaRT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaInviaRT                                       |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTV2Resp
        And from $paaInviaRTV2Resp.esito xml check value OK in position 0








    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in timeout e ricezione RPT2
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_37 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 in timeout BIZ attivazione fallita? --> probabilmente non c'è nodoInviaRPT con ccp-v2 rifiutata --> non toglie della coda dei retry della attiva e non fa paaInviaRT BIZ+ --> lo fa? (NM3-24)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_Timeout initial XML paaAttivaRPT
            | delay |
            | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is KO of nodoInviaRPT response
        And check description is RPT non accettabile per retry su Outcome a token scaduto of nodoInviaRPT response
        And wait 5 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PAAATTIVARPTRESP      | N                                              |
            | NODOINVIARPTREQ       | N                                              |
            | PAAATTIVARPTERROR     | N                                              |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                   |
            | RETRY_PENDING         | Y                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | ID_SESSIONE           | NotNone                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode              |
            | IUV                   | 12$iuv                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_RIFIUTATA_NODO           |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT                      |
            | INSERTED_TIMESTAMP    | NotNone                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA_KO                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And verify 0 record for the table RE retrived by the query on db re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                   |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO         | REQ                                            |
            | ESITO                     | RICEVUTA                                       |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                               |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                   |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO         | RESP                                           |
            | ESITO                     | INVIATA                                        |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                               |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value KO in position 0
        And from $nodoInviaRPTResp.fault.faultCode xml check value PPT_SEMANTICA in position 0
        And from $nodoInviaRPTResp.fault.faultString xml check value Errore semantico. in position 0
        And from $nodoInviaRPTResp.fault.id xml check value NodoDeiPagamentiSPC in position 0
        And from $nodoInviaRPTResp.fault.description xml check value RPT non accettabile per retry su Outcome a token scaduto in position 0







    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in timeout e ricezione RPT2
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_38 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 in timeout BIZ attivazione fallita? --> probabilmente non c'è nodoInviaRPT con ccp-v2 rifiutata --> non toglie della coda dei retry della attiva e non fa paaInviaRT BIZ+ --> lo fa? (NM3-50)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_Timeout initial XML paaAttivaRPT
            | delay |
            | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is KO of nodoInviaRPT response
        And check description is RPT non accettabile per retry su Outcome a token scaduto of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PAAATTIVARPTRESP      | N                                                |
            | NODOINVIARPTREQ       | N                                                |
            | PAAATTIVARPTERROR     | N                                                |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | nodoInviaRPT                                     |
            | RETRY_PENDING         | Y                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcomeV2                             |
            | UPDATED_BY                 | sendPaymentOutcomeV2                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcomeV2                             |
            | UPDATED_BY            | sendPaymentOutcomeV2                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | ID_SESSIONE           | NotNone                                          |
            | ID_SESSIONE_ORIGINALE | NotNone                                          |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                   | 12$iuv                                           |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_RIFIUTATA_NODO             |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT                        |
            | INSERTED_TIMESTAMP    | NotNone                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA_KO                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And verify 0 record for the table RE retrived by the query on db re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                     |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO         | REQ                                              |
            | ESITO                     | RICEVUTA                                         |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                                 |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                     |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO         | RESP                                             |
            | ESITO                     | INVIATA                                          |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                                 |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value KO in position 0
        And from $nodoInviaRPTResp.fault.faultCode xml check value PPT_SEMANTICA in position 0
        And from $nodoInviaRPTResp.fault.faultString xml check value Errore semantico. in position 0
        And from $nodoInviaRPTResp.fault.id xml check value NodoDeiPagamentiSPC in position 0
        And from $nodoInviaRPTResp.fault.description xml check value RPT non accettabile per retry su Outcome a token scaduto in position 0









    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in timeout e ricezione RPT2
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_39 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp1 activate e PSP vp2 spo: activate -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 ->  paaInviaRT- BIZ-, spoV2+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 in timeout BIZ attivazione fallita? --> probabilmente non c'è nodoInviaRPT con ccp-v2 rifiutata --> non toglie della coda dei retry della attiva e non fa paaInviaRT BIZ+ --> lo fa? (NM3-67)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeBody_noOptional initial XML activatePaymentNotice
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNotice to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNotice response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#             |
            | identificativoStazioneRichiedente | #id_station_old#                            |
            | dataOraMessaggioRichiesta         | #timedate#                                  |
            | dataEsecuzionePagamento           | #date#                                      |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                      |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNotice.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                             |
            | identificativoStazioneIntermediarioPA | #id_station_old#                            |
            | identificativoDominio                 | #creditor_institution_code_old#             |
            | identificativoUnivocoVersamento       | 12$iuv                                      |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken |
            | password                              | #password#                                  |
            | identificativoPSP                     | #pspFittizio#                               |
            | identificativoIntermediarioPSP        | #brokerFittizio#                            |
            | identificativoCanale                  | #canaleFittizio#                            |
            | rpt                                   | $rptAttachment                              |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_Timeout initial XML paaAttivaRPT
            | delay |
            | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeV2Body_noOptional initial XML sendPaymentOutcomeV2
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeResponse.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcomeV2 to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcomeV2 response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcomeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                |
            | identificativoStazioneRichiedente | #id_station_old#                               |
            | dataOraMessaggioRichiesta         | #timedate#                                     |
            | dataEsecuzionePagamento           | #date#                                         |
            | importoTotaleDaVersare            | $activatePaymentNotice.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                         |
            | codiceContestoPagamento           | $activatePaymentNoticeResponse.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNotice.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                |
            | identificativoStazioneIntermediarioPA | #id_station_old#                               |
            | identificativoDominio                 | #creditor_institution_code_old#                |
            | identificativoUnivocoVersamento       | 12$iuv                                         |
            | codiceContestoPagamento               | $activatePaymentNoticeResponse.paymentToken-v2 |
            | password                              | #password#                                     |
            | identificativoPSP                     | #pspFittizio#                                  |
            | identificativoIntermediarioPSP        | #brokerFittizio#                               |
            | identificativoCanale                  | #canaleFittizio#                               |
            | rpt                                   | $rptAttachment                                 |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is KO of nodoInviaRPT response
        And check description is RPT non accettabile per retry su Outcome a token scaduto of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                      |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PAAATTIVARPTRESP      | N                                              |
            | NODOINVIARPTREQ       | N                                              |
            | PAAATTIVARPTERROR     | N                                              |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | nodoInviaRPT                                   |
            | RETRY_PENDING         | Y                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | PAYMENT_TOKEN | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                         |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                          |
            | ID                         | NotNone                                        |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                         |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode              |
            | STATION_ID                 | #id_station_old#                               |
            | STATION_VERSION            | 1                                              |
            | PSP_ID                     | #psp#                                          |
            | BROKER_PSP_ID              | #id_broker_psp#                                |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                   |
            | IDEMPOTENCY_KEY            | None                                           |
            | AMOUNT                     | None                                           |
            | FEE                        | None                                           |
            | OUTCOME                    | OK                                             |
            | PAYMENT_METHOD             | None                                           |
            | PAYMENT_CHANNEL            | NA                                             |
            | TRANSFER_DATE              | None                                           |
            | PAYER_ID                   | None                                           |
            | APPLICATION_DATE           | None                                           |
            | INSERTED_TIMESTAMP         | NotNone                                        |
            | UPDATED_TIMESTAMP          | NotNone                                        |
            | FK_PAYMENT_PLAN            | NotNone                                        |
            | RPT_ID                     | None                                           |
            | PAYMENT_TYPE               | MOD3                                           |
            | CARRELLO_ID                | None                                           |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeResponse.paymentToken    |
            | FLAG_IO                    | N                                              |
            | RICEVUTA_PM                | None                                           |
            | FLAG_ACTIVATE_RESP_MISSING | None                                           |
            | FLAG_PAYPAL                | None                                           |
            | INSERTED_BY                | sendPaymentOutcomeV2                           |
            | UPDATED_BY                 | sendPaymentOutcomeV2                           |
            | TRANSACTION_ID             | None                                           |
            | CLOSE_VERSION              | None                                           |
            | FEE_PA                     | None                                           |
            | BUNDLE_ID                  | None                                           |
            | BUNDLE_PA_ID               | None                                           |
            | PM_INFO                    | None                                           |
            | MBD                        | N                                              |
            | FEE_SPO                    | None                                           |
            | PAYMENT_NOTE               | None                                           |
            | FLAG_STANDIN               | N                                              |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                       |
            | ID                         | NotNone                                     |
            | PA_FISCAL_CODE             | $activatePaymentNotice.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                      |
            | PAYMENT_TOKEN              | $activatePaymentNoticeResponse.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNotice.fiscalCode           |
            | STATION_ID                 | #id_station_old#                            |
            | STATION_VERSION            | 1                                           |
            | PSP_ID                     | #psp#                                       |
            | BROKER_PSP_ID              | #id_broker_psp#                             |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                |
            | IDEMPOTENCY_KEY            | None                                        |
            | AMOUNT                     | $activatePaymentNotice.amount               |
            | FEE                        | None                                        |
            | OUTCOME                    | None                                        |
            | PAYMENT_METHOD             | None                                        |
            | PAYMENT_CHANNEL            | NA                                          |
            | TRANSFER_DATE              | None                                        |
            | PAYER_ID                   | None                                        |
            | APPLICATION_DATE           | None                                        |
            | INSERTED_TIMESTAMP         | NotNone                                     |
            | UPDATED_TIMESTAMP          | NotNone                                     |
            | FK_PAYMENT_PLAN            | NotNone                                     |
            | RPT_ID                     | NotNone                                     |
            | PAYMENT_TYPE               | MOD3                                        |
            | CARRELLO_ID                | None                                        |
            | ORIGINAL_PAYMENT_TOKEN     | None                                        |
            | FLAG_IO                    | N                                           |
            | RICEVUTA_PM                | None                                        |
            | FLAG_ACTIVATE_RESP_MISSING | None                                        |
            | FLAG_PAYPAL                | None                                        |
            | INSERTED_BY                | activatePaymentNotice                       |
            | UPDATED_BY                 | activatePaymentNotice                       |
            | TRANSACTION_ID             | None                                        |
            | CLOSE_VERSION              | None                                        |
            | FEE_PA                     | None                                        |
            | BUNDLE_ID                  | None                                        |
            | BUNDLE_PA_ID               | None                                        |
            | PM_INFO                    | None                                        |
            | MBD                        | N                                           |
            | FEE_SPO                    | None                                        |
            | PAYMENT_NOTE               | None                                        |
            | FLAG_STANDIN               | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                           |
            | ID                    | NotNone                                         |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                     |
            | INSERTED_TIMESTAMP    | NotNone                                         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                          |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken     |
            | INSERTED_BY           | activatePaymentNotice,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                       |
            | ID                    | NotNone                                     |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                      |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken |
            | STATUS                | CANCELLED                                   |
            | INSERTED_TIMESTAMP    | NotNone                                     |
            | UPDATED_TIMESTAMP     | NotNone                                     |
            | FK_POSITION_PAYMENT   | NotNone                                     |
            | INSERTED_BY           | activatePaymentNotice                       |
            | UPDATED_BY            | mod3CancelV1                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                   |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | PA_FISCAL_CODE        | $activatePaymentNotice.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNotice.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                         |
            | PAYMENT_TOKEN         | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                     |
            | INSERTED_TIMESTAMP    | NotNone                                        |
            | UPDATED_TIMESTAMP     | NotNone                                        |
            | FK_POSITION_PAYMENT   | NotNone                                        |
            | INSERTED_BY           | sendPaymentOutcomeV2                           |
            | UPDATED_BY            | sendPaymentOutcomeV2                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                   |
            | NOTICE_ID      | $activatePaymentNotice.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNotice.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                        |
            | NOTICE_ID  | $activatePaymentNotice.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC           |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode                                                                              |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken                                                                    |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                   |
        # STATI_RPT -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                          |
            | ID                    | NotNone                                        |
            | ID_SESSIONE           | NotNone                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                        |
            | ID_DOMINIO            | $activatePaymentNotice.fiscalCode              |
            | IUV                   | 12$iuv                                         |
            | CCP                   | $activatePaymentNoticeResponse.paymentToken-v2 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_RIFIUTATA_NODO           |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT                      |
            | INSERTED_TIMESTAMP    | NotNone                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        And verify 2 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                      |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                       |
            | ID_SESSIONE        | NotNone                                     |
            | ID_DOMINIO         | $activatePaymentNotice.fiscalCode           |
            | IUV                | 12$iuv                                      |
            | CCP                | $activatePaymentNoticeResponse.paymentToken |
            | STATO              | RT_ACCETTATA_PA                             |
            | INSERTED_BY        | nodoInviaRPT                                |
            | UPDATED_BY         | paaInviaRT                                  |
            | INSERTED_TIMESTAMP | NotNone                                     |
            | UPDATED_TIMESTAMP  | NotNone                                     |
            | PUSH               | None                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                |
            | IUV        | 12$iuv                                      |
            | CCP        | $activatePaymentNoticeResponse.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                   |
            | IUV        | 12$iuv                                         |
            | CCP        | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                       |
            | ID_SESSIONE                 | NotNone                                     |
            | IDENT_DOMINIO               | $activatePaymentNotice.fiscalCode           |
            | IUV                         | 12$iuv                                      |
            | CCP                         | $activatePaymentNoticeResponse.paymentToken |
            | BIC_ADDEBITO                | NotNone                                     |
            | DATA_MSG_RICH               | NotNone                                     |
            | FLAG_CANC                   | N                                           |
            | IBAN_ADDEBITO               | NotNone                                     |
            | ID_MSG_RICH                 | NotNone                                     |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                            |
            | INTERMEDIARIOPA             | #id_broker_old#                             |
            | CANALE                      | #canaleFittizio#                            |
            | PSP                         | #pspFittizio#                               |
            | INTERMEDIARIOPSP            | #brokerFittizio#                            |
            | TIPO_VERSAMENTO             | PO                                          |
            | NUM_VERSAMENTI              | 1                                           |
            | RT_SIGNATURE_CODE           | 0                                           |
            | SOMMA_VERSAMENTI            | 10                                          |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                        |
            | FK_CARRELLO                 | None                                        |
            | INSERTED_TIMESTAMP          | NotNone                                     |
            | UPDATED_TIMESTAMP           | NotNone                                     |
            | RICEVUTA_PM                 | N                                           |
            | WISP_2                      | N                                           |
            | FLAG_SECONDA                | None                                        |
            | FLAG_IO                     | N                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                       |
            | ID_SESSIONE         | NotNone                                     |
            | IDENT_DOMINIO       | $activatePaymentNotice.fiscalCode           |
            | IUV                 | 12$iuv                                      |
            | CCP                 | $activatePaymentNoticeResponse.paymentToken |
            | COD_ESITO           | 1                                           |
            | ESITO               | NON_ESEGUITO                                |
            | DATA_RICEVUTA       | NotNone                                     |
            | DATA_RICHIESTA      | NotNone                                     |
            | ID_RICEVUTA         | NotNone                                     |
            | ID_RICHIESTA        | NotNone                                     |
            | SOMMA_VERSAMENTI    | 0                                           |
            | INSERTED_TIMESTAMP  | NotNone                                     |
            | UPDATED_TIMESTAMP   | NotNone                                     |
            | CANALE              | #canaleFittizio#                            |
            | NOTIFICA_PROCESSATA | N                                           |
            | GENERATA_DA         | NMP                                         |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                |
            | IUV           | 12$iuv                                      |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode           |
            | CCP           | $activatePaymentNoticeResponse.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                   |
            | IUV           | 12$iuv                                         |
            | IDENT_DOMINIO | $activatePaymentNotice.fiscalCode              |
            | CCP           | $activatePaymentNoticeResponse.paymentToken-v2 |
        # RE #####
        # activatePaymentNotice REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeReq
        And from $activatePaymentNoticeReq.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeReq.password xml check value #password# in position 0
        And from $activatePaymentNoticeReq.qrCode.fiscalCode xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeReq.qrCode.noticeNumber xml check value $activatePaymentNotice.noticeNumber in position 0
        And from $activatePaymentNoticeReq.amount xml check value $activatePaymentNotice.amount in position 0
        # activatePaymentNotice RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | activatePaymentNotice                       |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeResp
        And from $activatePaymentNoticeResp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeResp.totalAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.transferAmount xml check value $activatePaymentNotice.amount in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $activatePaymentNoticeResp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeResp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNotice.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcomeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Req
        And from $sendPaymentOutcomeV2Req.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeV2Req.password xml check value #password# in position 0
        And from $sendPaymentOutcomeV2Req.paymentToken xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $sendPaymentOutcomeV2Req.outcome xml check value OK in position 0
        # sendPaymentOutcomeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcomeV2                        |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeV2Resp
        And from $sendPaymentOutcomeV2Resp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                         |
            | ESITO              | INVIATA                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                        |
            | ESITO              | RICEVUTA                                    |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                            |
            | ORDER BY           | DATA_ORA_EVENTO ASC                         |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | REQ                                            |
            | ESITO              | INVIATA_KO                                     |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And verify 0 record for the table RE retrived by the query on db re with where datatable horizontal
            | where_keys         | where_values                                   |
            | PAYMENT_TOKEN      | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                   |
            | SOTTO_TIPO_EVENTO  | RESP                                           |
            | ESITO              | RICEVUTA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                               |
            | ORDER BY           | DATA_ORA_EVENTO ASC                            |
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                   |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO         | REQ                                            |
            | ESITO                     | RICEVUTA                                       |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                               |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNotice.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeResponse.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                   |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeResponse.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                   |
            | SOTTO_TIPO_EVENTO         | RESP                                           |
            | ESITO                     | INVIATA                                        |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                               |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                            |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value KO in position 0
        And from $nodoInviaRPTResp.fault.faultCode xml check value PPT_SEMANTICA in position 0
        And from $nodoInviaRPTResp.fault.faultString xml check value Errore semantico. in position 0
        And from $nodoInviaRPTResp.fault.id xml check value NodoDeiPagamentiSPC in position 0
        And from $nodoInviaRPTResp.fault.description xml check value RPT non accettabile per retry su Outcome a token scaduto in position 0









    # sessione scade dopo RPT ma prima di SPO (RPT in stato RT_ACCETTATA_PA), retry attiva in timeout e ricezione RPT2
    @ALL @FLOW @FLOW_FULL @NM3 @NM3PAOLD @NM3PAOLDRETRY @NM3PAOLDRETRY_FULL_40 @after
    Scenario: NM3 flow OK, FLOW con PA Old e PSP vp2 activate e PSP vp1 spo: activateV2 -> paaAttivaRPT, nodoInviaRPT (scadenza sessione) mod3cancelV1 -> paaInviaRT- BIZ-, spo+ con resp PPT_TOKEN_SCADUTO -> paaAttivaRPT con token-v2 in timeout BIZ attivazione fallita? --> probabilmente non c'è nodoInviaRPT con ccp-v2 rifiutata --> non toglie della coda dei retry della attiva e non fa paaInviaRT BIZ+ --> lo fa? (NM3-84)
        Given update parameter default_token_duration_validity_millis on configuration keys with value 2000
        And generic update through the query param_update_generic_where_condition of the table STAZIONI the parameter INVIO_RT_ISTANTANEO = 'Y', with where condition OBJ_ID = '16635' under macro update_query on db nodo_cfg
        And waiting after triggered refresh job ALL
        Given from body with datatable horizontal activatePaymentNoticeV2Body_noOptional initial XML activatePaymentNoticeV2
            | idPSP | idBrokerPSP | idChannel                    | password   | fiscalCode                  | noticeNumber | amount |
            | #psp# | #psp#       | #canale_ATTIVATO_PRESSO_PSP# | #password# | #creditor_institution_code# | 312#iuv#     | 10.00  |
        And from body with datatable horizontal paaAttivaRPT_noOptional initial XML paaAttivaRPT
            | esito | importoSingoloVersamento |
            | OK    | 10.00                    |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        When psp sends SOAP activatePaymentNoticeV2 to nodo-dei-pagamenti
        Then check outcome is OK of activatePaymentNoticeV2 response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#               |
            | identificativoStazioneRichiedente | #id_station_old#                              |
            | dataOraMessaggioRichiesta         | #timedate#                                    |
            | dataEsecuzionePagamento           | #date#                                        |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount               |
            | identificativoUnivocoVersamento   | 12$iuv                                        |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount               |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                               |
            | identificativoStazioneIntermediarioPA | #id_station_old#                              |
            | identificativoDominio                 | #creditor_institution_code_old#               |
            | identificativoUnivocoVersamento       | 12$iuv                                        |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken |
            | password                              | #password#                                    |
            | identificativoPSP                     | #pspFittizio#                                 |
            | identificativoIntermediarioPSP        | #brokerFittizio#                              |
            | identificativoCanale                  | #canaleFittizio#                              |
            | rpt                                   | $rptAttachment                                |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is OK of nodoInviaRPT response
        When job mod3CancelV1 triggered after 4 seconds
        Then verify the HTTP status code of mod3CancelV1 response is 200
        Given from body with datatable horizontal paaAttivaRPT_Timeout initial XML paaAttivaRPT
            | delay |
            | 10000 |
        And EC replies to nodo-dei-pagamenti with the paaAttivaRPT
        And from body with datatable horizontal sendPaymentOutcomeBody_noOptional initial XML sendPaymentOutcome
            | idPSP | idBrokerPSP     | idChannel                    | password   | paymentToken                                  | outcome |
            | #psp# | #id_broker_psp# | #canale_ATTIVATO_PRESSO_PSP# | #password# | $activatePaymentNoticeV2Response.paymentToken | OK      |
        When PSP sends SOAP sendPaymentOutcome to nodo-dei-pagamenti
        Then check outcome is KO of sendPaymentOutcome response
        And check faultCode is PPT_TOKEN_SCADUTO of sendPaymentOutcome response
        Given RPT generation RPT_generation with datatable vertical
            | identificativoDominio             | #creditor_institution_code_old#                  |
            | identificativoStazioneRichiedente | #id_station_old#                                 |
            | dataOraMessaggioRichiesta         | #timedate#                                       |
            | dataEsecuzionePagamento           | #date#                                           |
            | importoTotaleDaVersare            | $activatePaymentNoticeV2.amount                  |
            | identificativoUnivocoVersamento   | 12$iuv                                           |
            | codiceContestoPagamento           | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | importoSingoloVersamento          | $activatePaymentNoticeV2.amount                  |
        And from body with datatable vertical nodoInviaRPTBody_noOptional initial XML nodoInviaRPT
            | identificativoIntermediarioPA         | #id_broker_old#                                  |
            | identificativoStazioneIntermediarioPA | #id_station_old#                                 |
            | identificativoDominio                 | #creditor_institution_code_old#                  |
            | identificativoUnivocoVersamento       | 12$iuv                                           |
            | codiceContestoPagamento               | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | password                              | #password#                                       |
            | identificativoPSP                     | #pspFittizio#                                    |
            | identificativoIntermediarioPSP        | #brokerFittizio#                                 |
            | identificativoCanale                  | #canaleFittizio#                                 |
            | rpt                                   | $rptAttachment                                   |
        When EC sends SOAP nodoInviaRPT to nodo-dei-pagamenti
        Then check esito is KO of nodoInviaRPT response
        And check description is RPT non accettabile per retry su Outcome a token scaduto of nodoInviaRPT response
        And wait 1 seconds for expiration
        # RPT_ACTIVATIONS
        Given verify 0 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                        |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PAAATTIVARPTRESP      | N                                                |
            | NODOINVIARPTREQ       | N                                                |
            | PAAATTIVARPTERROR     | N                                                |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | nodoInviaRPT                                     |
            | RETRY_PENDING         | Y                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
        Given verify 1 record for the table RPT_ACTIVATIONS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | PAYMENT_TOKEN | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY      | INSERTED_TIMESTAMP ASC                           |
        # POSITION_PAYMENT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                            |
            | ID                         | NotNone                                          |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode              |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                           |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode              |
            | STATION_ID                 | #id_station_old#                                 |
            | STATION_VERSION            | 1                                                |
            | PSP_ID                     | #psp#                                            |
            | BROKER_PSP_ID              | #id_broker_psp#                                  |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                     |
            | IDEMPOTENCY_KEY            | None                                             |
            | AMOUNT                     | None                                             |
            | FEE                        | None                                             |
            | OUTCOME                    | OK                                               |
            | PAYMENT_METHOD             | None                                             |
            | PAYMENT_CHANNEL            | NA                                               |
            | TRANSFER_DATE              | None                                             |
            | PAYER_ID                   | None                                             |
            | APPLICATION_DATE           | None                                             |
            | INSERTED_TIMESTAMP         | NotNone                                          |
            | UPDATED_TIMESTAMP          | NotNone                                          |
            | FK_PAYMENT_PLAN            | NotNone                                          |
            | RPT_ID                     | None                                             |
            | PAYMENT_TYPE               | MOD3                                             |
            | CARRELLO_ID                | None                                             |
            | ORIGINAL_PAYMENT_TOKEN     | $activatePaymentNoticeV2Response.paymentToken    |
            | FLAG_IO                    | N                                                |
            | RICEVUTA_PM                | None                                             |
            | FLAG_ACTIVATE_RESP_MISSING | None                                             |
            | FLAG_PAYPAL                | None                                             |
            | INSERTED_BY                | sendPaymentOutcome                             |
            | UPDATED_BY                 | sendPaymentOutcome                             |
            | TRANSACTION_ID             | None                                             |
            | CLOSE_VERSION              | None                                             |
            | FEE_PA                     | None                                             |
            | BUNDLE_ID                  | None                                             |
            | BUNDLE_PA_ID               | None                                             |
            | PM_INFO                    | None                                             |
            | MBD                        | N                                                |
            | FEE_SPO                    | None                                             |
            | PAYMENT_NOTE               | None                                             |
            | FLAG_STANDIN               | N                                                |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                     | value                                         |
            | ID                         | NotNone                                       |
            | PA_FISCAL_CODE             | $activatePaymentNoticeV2.fiscalCode           |
            | CREDITOR_REFERENCE_ID      | 12$iuv                                        |
            | PAYMENT_TOKEN              | $activatePaymentNoticeV2Response.paymentToken |
            | BROKER_PA_ID               | $activatePaymentNoticeV2.fiscalCode           |
            | STATION_ID                 | #id_station_old#                              |
            | STATION_VERSION            | 1                                             |
            | PSP_ID                     | #psp#                                         |
            | BROKER_PSP_ID              | #id_broker_psp#                               |
            | CHANNEL_ID                 | #canale_ATTIVATO_PRESSO_PSP#                  |
            | IDEMPOTENCY_KEY            | None                                          |
            | AMOUNT                     | $activatePaymentNoticeV2.amount               |
            | FEE                        | None                                          |
            | OUTCOME                    | None                                          |
            | PAYMENT_METHOD             | None                                          |
            | PAYMENT_CHANNEL            | NA                                            |
            | TRANSFER_DATE              | None                                          |
            | PAYER_ID                   | None                                          |
            | APPLICATION_DATE           | None                                          |
            | INSERTED_TIMESTAMP         | NotNone                                       |
            | UPDATED_TIMESTAMP          | NotNone                                       |
            | FK_PAYMENT_PLAN            | NotNone                                       |
            | RPT_ID                     | NotNone                                       |
            | PAYMENT_TYPE               | MOD3                                          |
            | CARRELLO_ID                | None                                          |
            | ORIGINAL_PAYMENT_TOKEN     | None                                          |
            | FLAG_IO                    | N                                             |
            | RICEVUTA_PM                | None                                          |
            | FLAG_ACTIVATE_RESP_MISSING | None                                          |
            | FLAG_PAYPAL                | None                                          |
            | INSERTED_BY                | activatePaymentNoticeV2                       |
            | UPDATED_BY                 | activatePaymentNoticeV2                       |
            | TRANSACTION_ID             | None                                          |
            | CLOSE_VERSION              | None                                          |
            | FEE_PA                     | None                                          |
            | BUNDLE_ID                  | None                                          |
            | BUNDLE_PA_ID               | None                                          |
            | PM_INFO                    | None                                          |
            | MBD                        | N                                             |
            | FEE_SPO                    | None                                          |
            | PAYMENT_NOTE               | None                                          |
            | FLAG_STANDIN               | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        # POSITION_PAYMENT_STATUS
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                             |
            | ID                    | NotNone                                           |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode               |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber             |
            | STATUS                | PAYING,PAYING_RPT,CANCELLED                       |
            | INSERTED_TIMESTAMP    | NotNone                                           |
            | CREDITOR_REFERENCE_ID | 12$iuv                                            |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken     |
            | INSERTED_BY           | activatePaymentNoticeV2,nodoInviaRPT,mod3CancelV1 |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 3 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | INSERTED_BY           | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 1 record for the table POSITION_PAYMENT_STATUS retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # POSITION_PAYMENT_STATUS_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                         |
            | ID                    | NotNone                                       |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode           |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber         |
            | CREDITOR_REFERENCE_ID | 12$iuv                                        |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken |
            | STATUS                | CANCELLED                                     |
            | INSERTED_TIMESTAMP    | NotNone                                       |
            | UPDATED_TIMESTAMP     | NotNone                                       |
            | FK_POSITION_PAYMENT   | NotNone                                       |
            | INSERTED_BY           | activatePaymentNoticeV2                       |
            | UPDATED_BY            | mod3CancelV1                                  |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                  |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber         |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode           |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                     |
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | PA_FISCAL_CODE        | $activatePaymentNoticeV2.fiscalCode              |
            | NOTICE_ID             | $activatePaymentNoticeV2.noticeNumber            |
            | CREDITOR_REFERENCE_ID | 12$iuv                                           |
            | PAYMENT_TOKEN         | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATUS                | PAID_NORPT                                       |
            | INSERTED_TIMESTAMP    | NotNone                                          |
            | UPDATED_TIMESTAMP     | NotNone                                          |
            | FK_POSITION_PAYMENT   | NotNone                                          |
            | INSERTED_BY           | sendPaymentOutcome                             |
            | UPDATED_BY            | sendPaymentOutcome                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys     | where_values                                     |
            | NOTICE_ID      | $activatePaymentNoticeV2.noticeNumber            |
            | PA_FISCAL_CODE | $activatePaymentNoticeV2.fiscalCode              |
            | PAYMENT_TOKEN  | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY       | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table POSITION_PAYMENT_STATUS_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                          |
            | NOTICE_ID  | $activatePaymentNoticeV2.noticeNumber |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC             |
        # STATI_RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                                                                                          |
            | ID                    | NotNone                                                                                                        |
            | ID_SESSIONE           | NotNone                                                                                                        |
            | ID_SESSIONE_ORIGINALE | NotNone                                                                                                        |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode                                                                            |
            | IUV                   | 12$iuv                                                                                                         |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken                                                                  |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_ACCETTATA_NODO,RPT_PARCHEGGIATA_NODO_MOD3,RT_GENERATA_NODO,RT_INVIATA_PA,RT_ACCETTATA_PA |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT,nodoInviaRPT,mod3CancelV1,mod3CancelV1,paaInviaRT                                    |
            | INSERTED_TIMESTAMP    | NotNone                                                                                                        |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        And verify 6 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                     |
        # STATI_RPT -v2
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                | value                                            |
            | ID                    | NotNone                                          |
            | ID_SESSIONE           | NotNone                                          |
            | ID_SESSIONE_ORIGINALE | NotNone                                          |
            | ID_DOMINIO            | $activatePaymentNoticeV2.fiscalCode              |
            | IUV                   | 12$iuv                                           |
            | CCP                   | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | STATO                 | RPT_RICEVUTA_NODO,RPT_RIFIUTATA_NODO             |
            | INSERTED_BY           | nodoInviaRPT,nodoInviaRPT                        |
            | INSERTED_TIMESTAMP    | NotNone                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        And verify 2 record for the table STATI_RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | ORDER BY   | INSERTED_TIMESTAMP,ID ASC                        |
        # STATI_RPT_SNAPSHOT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column             | value                                         |
            | ID_SESSIONE        | NotNone                                       |
            | ID_DOMINIO         | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                | 12$iuv                                        |
            | CCP                | $activatePaymentNoticeV2Response.paymentToken |
            | STATO              | RT_ACCETTATA_PA                               |
            | INSERTED_BY        | nodoInviaRPT                                  |
            | UPDATED_BY         | paaInviaRT                                    |
            | INSERTED_TIMESTAMP | NotNone                                       |
            | UPDATED_TIMESTAMP  | NotNone                                       |
            | PUSH               | None                                          |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                  |
            | IUV        | 12$iuv                                        |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken |
        # STATI_RPT_SNAPSHOT -v2
        And verify 0 record for the table STATI_RPT_SNAPSHOT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys | where_values                                     |
            | IUV        | 12$iuv                                           |
            | CCP        | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RPT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column                      | value                                         |
            | ID_SESSIONE                 | NotNone                                       |
            | IDENT_DOMINIO               | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                         | 12$iuv                                        |
            | CCP                         | $activatePaymentNoticeV2Response.paymentToken |
            | BIC_ADDEBITO                | NotNone                                       |
            | DATA_MSG_RICH               | NotNone                                       |
            | FLAG_CANC                   | N                                             |
            | IBAN_ADDEBITO               | NotNone                                       |
            | ID_MSG_RICH                 | NotNone                                       |
            | STAZ_INTERMEDIARIOPA        | #id_station_old#                              |
            | INTERMEDIARIOPA             | #id_broker_old#                               |
            | CANALE                      | #canaleFittizio#                              |
            | PSP                         | #pspFittizio#                                 |
            | INTERMEDIARIOPSP            | #brokerFittizio#                              |
            | TIPO_VERSAMENTO             | PO                                            |
            | NUM_VERSAMENTI              | 1                                             |
            | RT_SIGNATURE_CODE           | 0                                             |
            | SOMMA_VERSAMENTI            | 10                                            |
            | PARAMETRI_PROFILO_PAGAMENTO | None                                          |
            | FK_CARRELLO                 | None                                          |
            | INSERTED_TIMESTAMP          | NotNone                                       |
            | UPDATED_TIMESTAMP           | NotNone                                       |
            | RICEVUTA_PM                 | N                                             |
            | WISP_2                      | N                                             |
            | FLAG_SECONDA                | None                                          |
            | FLAG_IO                     | N                                             |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RPT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RT
        And generate list columns list_columns and dict fields values expected dict_fields_values_expected for query checks all values with datatable horizontal
            | column              | value                                         |
            | ID_SESSIONE         | NotNone                                       |
            | IDENT_DOMINIO       | $activatePaymentNoticeV2.fiscalCode           |
            | IUV                 | 12$iuv                                        |
            | CCP                 | $activatePaymentNoticeV2Response.paymentToken |
            | COD_ESITO           | 1                                             |
            | ESITO               | NON_ESEGUITO                                  |
            | DATA_RICEVUTA       | NotNone                                       |
            | DATA_RICHIESTA      | NotNone                                       |
            | ID_RICEVUTA         | NotNone                                       |
            | ID_RICHIESTA        | NotNone                                       |
            | SOMMA_VERSAMENTI    | 0                                             |
            | INSERTED_TIMESTAMP  | NotNone                                       |
            | UPDATED_TIMESTAMP   | NotNone                                       |
            | CANALE              | #canaleFittizio#                              |
            | NOTIFICA_PROCESSATA | N                                             |
            | GENERATA_DA         | NMP                                           |
        And checks all values by $dict_fields_values_expected of the record for each columns $list_columns of the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 1 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                  |
            | IUV           | 12$iuv                                        |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode           |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken |
        And verify 0 record for the table RT retrived by the query on db nodo_online with where datatable horizontal
            | where_keys    | where_values                                     |
            | IUV           | 12$iuv                                           |
            | IDENT_DOMINIO | $activatePaymentNoticeV2.fiscalCode              |
            | CCP           | $activatePaymentNoticeV2Response.paymentToken-v2 |
        # RE #####
        # activatePaymentNoticeV2 REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Req
        And from $activatePaymentNoticeV2Req.idPSP xml check value #psp# in position 0
        And from $activatePaymentNoticeV2Req.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $activatePaymentNoticeV2Req.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $activatePaymentNoticeV2Req.password xml check value #password# in position 0
        And from $activatePaymentNoticeV2Req.qrCode.fiscalCode xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Req.qrCode.noticeNumber xml check value $activatePaymentNoticeV2.noticeNumber in position 0
        And from $activatePaymentNoticeV2Req.amount xml check value $activatePaymentNoticeV2.amount in position 0
        # activatePaymentNoticeV2 RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | activatePaymentNoticeV2                       |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key activatePaymentNoticeV2Resp
        And from $activatePaymentNoticeV2Resp.outcome xml check value OK in position 0
        And from $activatePaymentNoticeV2Resp.totalAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.idTransfer xml check value 1 in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.transferAmount xml check value $activatePaymentNoticeV2.amount in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.fiscalCodePA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $activatePaymentNoticeV2Resp.transferList.transfer.IBAN xml check value NotNone in position 0
        And from $activatePaymentNoticeV2Resp.creditorReferenceId xml check value 12$iuv in position 0
        # paaAttivaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaAttivaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $paaAttivaRPTReq.identificativoCanalePSP xml check value #canaleFittizio# in position 0
        # paaAttivaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaAttivaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTResp
        And from $paaAttivaRPTResp.esito xml check value OK in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.importoSingoloVersamento xml check value $activatePaymentNoticeV2.amount in position 0
        And from $paaAttivaRPTResp.datiPagamentoPA.ibanAccredito xml check value NotNone in position 0
        # sendPaymentOutcome REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeReq
        And from $sendPaymentOutcomeReq.idPSP xml check value #psp# in position 0
        And from $sendPaymentOutcomeReq.idBrokerPSP xml check value #id_broker_psp# in position 0
        And from $sendPaymentOutcomeReq.idChannel xml check value #canale_ATTIVATO_PRESSO_PSP# in position 0
        And from $sendPaymentOutcomeReq.password xml check value #password# in position 0
        And from $sendPaymentOutcomeReq.paymentToken xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $sendPaymentOutcomeReq.outcome xml check value OK in position 0
        # sendPaymentOutcome RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | sendPaymentOutcome                          |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key sendPaymentOutcomeResp
        And from $sendPaymentOutcomeResp.outcome xml check value KO in position 0
        # nodoInviaRPT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $nodoInviaRPTReq.password xml check value #password# in position 0
        And from $nodoInviaRPTReq.identificativoPSP xml check value #pspFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoIntermediarioPSP xml check value #brokerFittizio# in position 0
        And from $nodoInviaRPTReq.identificativoCanale xml check value #canaleFittizio# in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | nodoInviaRPT                                  |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value OK in position 0
        And from $nodoInviaRPTResp.redirect xml check value 0 in position 0
        # paaInviaRT REQ
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | REQ                                           |
            | ESITO              | INVIATA                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTReq
        And from $paaInviaRTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaInviaRTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaInviaRTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaInviaRTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken in position 0
        And from $paaInviaRTReq.rt xml check value NotNone in position 0
        # paaInviaRT RESP
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                  |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken |
            | TIPO_EVENTO        | paaInviaRT                                    |
            | SOTTO_TIPO_EVENTO  | RESP                                          |
            | ESITO              | RICEVUTA                                      |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                              |
            | ORDER BY           | DATA_ORA_EVENTO ASC                           |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaInviaRTResp
        And from $paaInviaRTResp.esito xml check value OK in position 0
        # paaAttivaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | REQ                                              |
            | ESITO              | INVIATA_KO                                       |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key paaAttivaRPTReq
        And from $paaAttivaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $paaAttivaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $paaAttivaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $paaAttivaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $paaAttivaRPTReq.datiPagamentoPSP.importoSingoloVersamento xml check value 10.00 in position 0
        # paaAttivaRPT RESP con -v2
        And verify 0 record for the table RE retrived by the query on db re with where datatable horizontal
            | where_keys         | where_values                                     |
            | PAYMENT_TOKEN      | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO        | paaAttivaRPT                                     |
            | SOTTO_TIPO_EVENTO  | RESP                                             |
            | ESITO              | RICEVUTA                                         |
            | INSERTED_TIMESTAMP | TRUNC(SYSDATE-1)                                 |
            | ORDER BY           | DATA_ORA_EVENTO ASC                              |
        # nodoInviaRPT REQ con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                     |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO         | REQ                                              |
            | ESITO                     | RICEVUTA                                         |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                                 |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTReq
        And from $nodoInviaRPTReq.identificativoIntermediarioPA xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoDominio xml check value $activatePaymentNoticeV2.fiscalCode in position 0
        And from $nodoInviaRPTReq.identificativoStazioneIntermediarioPA xml check value #id_station_old# in position 0
        And from $nodoInviaRPTReq.identificativoUnivocoVersamento xml check value 12$iuv in position 0
        And from $nodoInviaRPTReq.codiceContestoPagamento xml check value $activatePaymentNoticeV2Response.paymentToken-v2 in position 0
        And from $nodoInviaRPTReq.rpt xml check value NotNone in position 0
        # nodoInviaRPT RESP con -v2
        And execution query to get value result_query on the table RE, with the columns PAYLOAD with db name re with where datatable horizontal
            | where_keys                | where_values                                     |
            | CODICE_CONTESTO_PAGAMENTO | $activatePaymentNoticeV2Response.paymentToken-v2 |
            | TIPO_EVENTO               | nodoInviaRPT                                     |
            | SOTTO_TIPO_EVENTO         | RESP                                             |
            | ESITO                     | INVIATA                                          |
            | INSERTED_TIMESTAMP        | TRUNC(SYSDATE-1)                                 |
            | ORDER BY                  | DATA_ORA_EVENTO ASC                              |
        And through the query result_query retrieve xml PAYLOAD at position 0 and save it under the key nodoInviaRPTResp
        And from $nodoInviaRPTResp.esito xml check value KO in position 0
        And from $nodoInviaRPTResp.fault.faultCode xml check value PPT_SEMANTICA in position 0
        And from $nodoInviaRPTResp.fault.faultString xml check value Errore semantico. in position 0
        And from $nodoInviaRPTResp.fault.id xml check value NodoDeiPagamentiSPC in position 0
        And from $nodoInviaRPTResp.fault.description xml check value RPT non accettabile per retry su Outcome a token scaduto in position 0